<%- include('../partes/header') %>

<h1>Editar Gift Card</h1>

<form id="formEditarGiftCard" enctype="multipart/form-data">
    <input type="hidden" name="giftcardId" value="<%= giftcard.id %>">

    <label>Nombre:</label>
    <input type="text" name="nombre" value="<%= giftcard.nombre %>" required><br>

    <label>Precio:</label>
    <input type="number" step="0.01" name="precio" value="<%= giftcard.precio %>" required><br>

    <label>Empresa:</label>
    <input type="text" name="empresa" value="<%= giftcard.empresa %>" required><br>

    <label>Consola:</label>
    <input type="text" name="consola" value="<%= giftcard.consola %>" required><br>

    <label>Requerimientos MÃ­nimos:</label>
    <input type="text" name="requerimientos_minimos" value="<%= giftcard.requerimientos_minimos %>" required><br>

    <label>Stock:</label>
    <input type="number" name="stock" value="<%= giftcard.stock %>" required><br>

    <label>Fecha de Caducidad:</label>
    <input type="date" name="fecha_caducidad" value="<%= giftcard.fecha_caducidad.toISOString().split('T')[0] %>" required><br>

    <label>Plataformas Disponibles:</label>
    <input type="text" name="plataformas_disponibles" value="<%= giftcard.plataformas_disponibles %>" required><br>

    <label>Imagen:</label>
    <input type="file" name="imagen"><br>
    <small>Imagen actual: <%= giftcard.imagen ? giftcard.imagen : 'No disponible' %></small><br><br>

    <button type="submit">Guardar Cambios</button>
</form>

<a href="/admin/giftcards">Volver al listado</a>

<script>
    const token = '<%= token %>'; // Asegurate de pasar el token desde el router

    document.getElementById('formEditarGiftCard').addEventListener('submit', async function (e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);
        const giftcardId = formData.get('giftcardId');

        try {
            const response = await fetch(`/api/giftcards/${giftcardId}/modificar`, {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                body: formData
            });

            if (!response.ok) {
                let errorData;
                try {
                    errorData = await response.json();
                } catch {
                    errorData = { message: 'No se pudo interpretar el error del servidor' };
                }
                alert('Error: ' + (errorData.message || JSON.stringify(errorData)));
                return;
            }

            alert('GiftCard actualizada correctamente');
            window.location.href = '/admin/giftcards'; // Redirige al listado

        } catch (err) {
            console.error(err);
            alert('Error de red o servidor: ' + err.message);
        }
    });
</script>

<%- include('../partes/footer') %>
