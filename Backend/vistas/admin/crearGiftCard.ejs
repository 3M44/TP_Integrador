<%- include('../partes/header') %>

<h1>Agregar Nueva GiftCard</h1>

<form id="formCrearGiftCard" enctype="multipart/form-data">
    <label for="nombre">Nombre:</label>
    <input type="text" name="nombre" required>

    <label for="precio">Precio:</label>
    <input type="number" name="precio" step="0.01" required>

    <label for="empresa">Empresa:</label>
    <input type="text" name="empresa">

    <label for="consola">Consola:</label>
    <input type="text" name="consola">

    <label for="requerimientos_minimos">Requisitos:</label>
    <input type="text" name="requerimientos_minimos">

    <label for="stock">Stock:</label>
    <input type="number" name="stock">

    <label for="fecha_caducidad">Fecha de Caducidad:</label>
    <input type="date" name="fecha_caducidad">

    <label for="plataformas_disponibles">Plataformas:</label>
    <input type="text" name="plataformas_disponibles">

    <label for="imagen">Imagen:</label>
    <input type="file" name="imagen">

    <button type="submit">Crear GiftCard</button>
</form>

<a href="/admin/panel">Volver al Panel</a>

<script>
    const token = '<%= token %>'; // Asegurate de pasarlo desde el router

    document.getElementById('formCrearGiftCard').addEventListener('submit', async function (e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        try {
            const response = await fetch('/api/giftcards/subirGiftCard', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                    // No pongas 'Content-Type', fetch lo maneja solo con FormData
                },
                body: formData
            });

            if (!response.ok) {
                let errorData;
                try {
                    errorData = await response.json();
                } catch {
                    errorData = { message: 'No se pudo interpretar el error del servidor' };
                }
                alert('Error: ' + (errorData.message || JSON.stringify(errorData)));
                return;
            }

            alert('GiftCard creada correctamente');
            window.location.href = '/admin/panel'; // Redirige al panel

        } catch (err) {
            console.error(err);
            alert('Error de red o servidor: ' + err.message);
        }
    });
</script>

<%- include('../partes/footer') %>
