<%- include('../partes/header') %>

<h1>Agregar Nuevo Juego</h1>
<div class="container mt-4">
  <h2 class="mb-4">Crear Juego</h2>

  <form id="formCrearJuego" enctype="multipart/form-data" class="row g-3">
    <div class="col-md-6">
      <label for="nombre" class="form-label">Nombre</label>
      <input type="text" name="nombre" class="form-control" required>
    </div>

    <div class="col-md-6">
      <label for="precio" class="form-label">Precio</label>
      <input type="number" name="precio" step="0.01" class="form-control" required>
    </div>

    <div class="col-md-12">
      <label for="descripcion" class="form-label">Descripci√≥n</label>
      <textarea name="descripcion" rows="3" class="form-control"></textarea>
    </div>

    <div class="col-md-6">
      <label for="stock" class="form-label">Stock</label>
      <input type="number" name="stock" class="form-control" required>
    </div>

    <div class="col-md-6">
      <label for="empresa" class="form-label">Empresa</label>
      <input type="text" name="empresa" class="form-control">
    </div>

    <div class="col-md-6">
      <label for="consola" class="form-label">Consola</label>
      <input type="text" name="consola" class="form-control">
    </div>

    <div class="col-md-6">
      <label for="fecha_lanzamiento" class="form-label">Fecha de Lanzamiento</label>
      <input type="date" name="fecha_lanzamiento" class="form-control">
    </div>

    <div class="col-md-12">
      <label for="requerimientos_minimos" class="form-label">Requisitos</label>
      <input type="text" name="requerimientos_minimos" class="form-control">
    </div>

    <div class="col-md-12">
      <label for="plataformas_disponibles" class="form-label">Plataformas</label>
      <input type="text" name="plataformas_disponibles" class="form-control">
    </div>

    <div class="col-md-12">
      <label for="imagen" class="form-label">Imagen</label>
      <input type="file" name="imagen" class="form-control">
    </div>

    <div class="col-12 d-flex justify-content-between mt-3">
      <a href="/admin/panelProductos" class="btn btn-secondary">Volver al Panel</a>
      <button type="submit" class="btn btn-primary">Crear Juego</button>
    </div>
  </form>
</div>

<script>
    const token = '<%= token %>'; 

    document.getElementById('formCrearJuego').addEventListener('submit', async function (e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);

        try {
            const response = await fetch('/api/juegos/subirJuego', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                body: formData
            });

            if (!response.ok) {
                let errorData;
                try {
                    errorData = await response.json();
                } catch {
                    errorData = { message: 'No se pudo interpretar el error del servidor' };
                }
                alert('Error: ' + (errorData.message || JSON.stringify(errorData)));
                return;
            }

            alert('Juego creado correctamente');
            window.location.href = '/admin/panelProductos'; // Redirige al panel

        } catch (err) {
            console.error(err);
            alert('Error de red o servidor: ' + err.message);
        }
    });
</script>

<%- include('../partes/footer') %>
