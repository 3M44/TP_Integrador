<%- include('../partes/header') %>

<h1>Editar Juego: <%= juego.nombre %></h1>

<form id="formEditarJuego" enctype="multipart/form-data">
    <input type="hidden" name="juegoId" value="<%= juego.id %>">

    <label>Nombre:</label>
    <input type="text" name="nombre" value="<%= juego.nombre %>" required><br>

    <label>Precio:</label>
    <input type="number" step="0.01" name="precio" value="<%= juego.precio %>" required><br>

    <label>Empresa:</label>
    <input type="text" name="empresa" value="<%= juego.empresa %>" required><br>

    <label>Consola:</label>
    <input type="text" name="consola" value="<%= juego.consola %>" required><br>

    <label>Requerimientos mínimos:</label>
    <input type="text" name="requerimientos_minimos" value="<%= juego.requerimientos_minimos %>" required><br>

    <label>Stock:</label>
    <input type="number" name="stock" value="<%= juego.stock %>" required><br>

    <label>Género:</label>
    <input type="text" name="genero" value="<%= juego.genero %>" required><br>

    <label>Puntuación:</label>
    <input type="number" step="0.1" name="puntuacion_general" value="<%= juego.puntuacion_general %>" required><br>

    <label>Imagen actual:</label><br>
    <% if (juego.imagen) { %>
        <img src="<%= juego.imagen %>" alt="Imagen Juego" width="150"><br>
    <% } else { %>
        <p>Sin imagen</p>
    <% } %>

    <label>Actualizar Imagen:</label>
    <input type="file" name="imagen"><br><br>

    <button type="submit">Actualizar Juego</button>
</form>

<br>
<a href="/admin/juegos">Volver al Panel</a>

<script>
    const token = '<%= token %>'; // El token debe ser pasado desde el backend

    document.getElementById('formEditarJuego').addEventListener('submit', async function (e) {
        e.preventDefault();

        const form = e.target;
        const formData = new FormData(form);
        const juegoId = formData.get('juegoId');

        try {
            const response = await fetch(`/api/juegos/${juegoId}/actualizar`, {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                body: formData
            });

            if (!response.ok) {
                const errorData = await response.json();
                alert('Error: ' + (errorData.message || 'Error al actualizar el juego'));
                return;
            }

            alert('Juego actualizado correctamente');
            window.location.href = '/admin/juegos'; // Redirige al panel

        } catch (err) {
            console.error(err);
            alert('Error de red o servidor');
        }
    });
</script>

<%- include('../partes/footer') %>